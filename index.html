<!DOCTYPE html>
<html>








  
    <link rel="stylesheet" href="/css/bundle.min.a95d1c35553810095f827440b4abbe6f8b9e27cb6baaff803d538c963505795a.css" integrity="sha256-qV0cNVU4EAlfgnRAtKu&#43;b4ueJ8trqv&#43;APVOMljUFeVo=" crossorigin="anonymous">
  







  
  <script type="text/javascript" src="/js/app.378252abc5b0a5096d4ec9f8fb1ebacbce55b4304822af2bdd839b18f8938106.js" integrity="sha256-N4JSq8WwpQltTsn4&#43;x66y85VtDBIIq8r3YObGPiTgQY=" crossorigin="anonymous" defer></script>
  
  


<link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css"/>
<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap" rel="stylesheet">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script><body><div id="content">
<section class="mw7 center">

<nav>
  
  <div class="mw7 flex items-center justify-between contain">
    <div class="db">
      <a href="/" class="dib avenir link blog-title">Dqfort&#39;s blog</a>

      <small class="avenir f7 black-70 fw2">
        satisfy or build better.
      </small>
    </div>

    <div class="db">
      <div class="flex items-center justify-end">
        <a class="link near-black hover-silver dib h1 w1 mr3" href="https://github.com/dqfort" title="GitHub">
          <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.083-.202-.358-1.015.077-2.117 0 0 .672-.215 2.2.82.638-.178 1.323-.266 2.003-.27.68.004 1.364.092 2.003.27 1.527-1.035 2.198-.82 2.198-.82.437 1.102.163 1.915.08 2.117.513.56.823 1.274.823 2.147 0 3.073-1.87 3.75-3.653 3.947.287.246.543.735.543 1.48 0 1.07-.01 1.933-.01 2.195 0 .215.144.463.55.385C13.71 14.53 16 11.534 16 8c0-4.418-3.582-8-8-8"/></svg>
        </a>

        <a class="link hover-silver h1 w1 rss" href="index.xml" title="">
          <svg data-icon="rss" viewBox="0 0 24 24" style="fill:currentcolor"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"/></svg>
        </a>
      </div>
    </div>
  </div>
</nav>





  <article class="ph4-ns pv5-ns">
    
    <h1 class="f2 fw1 avenir blog-heading">Webview App Architecture</h1>
    
    <time class="f6 db gray avenir">2022-02-27</time>
    <div class="f6 black-70 avenir lh-copy">
      <p>To build mobile app, you might consider using React native or Flutter. But using webview could also be considered, as following diagram:</p>
<p><img src="/web_architecture.png" alt="webview app"></p>
<p>As you see the HTML content can share to both Android and iOS as UI development. You might also notice that also includes web servers in mobile app, there are some purposes for the setup:</p>
<ol>
<li>To run web frameworks properly (Most frontend framework needs HTTP server for routing)</li>
<li>Handle async action easier via http request/response</li>
<li>More security as you can hidden tokens in mobile, using the web server as proxy</li>
</ol>
<p>In Android, I found <a href="https://ktor.io/">Ktor</a> for setup a web server:</p>
<div class="highlight"><pre class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="n">embeddedServer</span><span class="p">(</span><span class="n">Netty</span><span class="p">,</span> <span class="n">port</span> <span class="p">=</span> <span class="m">8080</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">routing</span> <span class="p">{</span>
        <span class="k">get</span><span class="p">(</span><span class="s">&#34;/myreactapp/{...}&#34;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">val</span> <span class="py">uri</span> <span class="p">=</span> <span class="n">call</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">uri</span>
            <span class="k">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">uri</span><span class="p">.</span><span class="n">removePrefix</span><span class="p">(</span><span class="s">&#34;/myreactapp/&#34;</span><span class="p">)</span>
            <span class="k">val</span> <span class="py">ext</span> <span class="p">=</span> <span class="n">path</span><span class="o">?.</span><span class="n">substringAfterLast</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">)</span>

            <span class="k">val</span> <span class="py">reg</span> <span class="p">=</span> <span class="n">Regex</span><span class="p">(</span><span class="s">&#34;png|jpg|js|css|ico|json|svg&#34;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ext</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">reg</span><span class="p">.</span><span class="n">matches</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">var</span> <span class="py">contentType</span> <span class="p">=</span> <span class="s">&#34;&#34;</span>
                <span class="k">when</span> <span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="p">{</span>
                    <span class="s">&#34;icon&#34;</span> <span class="p">-&gt;</span> <span class="n">contentType</span> <span class="p">=</span> <span class="s">&#34;image/x-icon&#34;</span>
                    <span class="s">&#34;jpg&#34;</span> <span class="p">-&gt;</span> <span class="n">contentType</span> <span class="p">=</span> <span class="s">&#34;image/jpeg&#34;</span>
                    <span class="s">&#34;png&#34;</span> <span class="p">-&gt;</span> <span class="n">contentType</span> <span class="p">=</span> <span class="s">&#34;image/png&#34;</span>
                    <span class="s">&#34;css&#34;</span> <span class="p">-&gt;</span> <span class="n">contentType</span> <span class="p">=</span> <span class="s">&#34;text/css; charset=UTF-8&#34;</span>
                    <span class="s">&#34;js&#34;</span> <span class="p">-&gt;</span> <span class="n">contentType</span> <span class="p">=</span> <span class="s">&#34;application/javascript; charset=UTF-8&#34;</span>
                    <span class="s">&#34;json&#34;</span> <span class="p">-&gt;</span> <span class="n">contentType</span> <span class="p">=</span> <span class="s">&#34;application/json; charset=UTF-8&#34;</span>
                    <span class="s">&#34;svg&#34;</span> <span class="p">-&gt;</span> <span class="n">contentType</span> <span class="p">=</span> <span class="s">&#34;image/svg+xml&#34;</span>
                <span class="p">}</span>

                <span class="n">call</span><span class="p">.</span><span class="n">respondOutputStream</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">contentType</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">val</span> <span class="py">f</span> <span class="p">=</span> <span class="n">assets</span><span class="p">.</span><span class="k">open</span><span class="p">(</span><span class="s">&#34;myreactapp/${path}&#34;</span><span class="p">)</span>
                    <span class="n">f</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">call</span><span class="p">.</span><span class="n">respondOutputStream</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&#34;text/html; charset=UTF-8&#34;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">val</span> <span class="py">indexHtml</span> <span class="p">=</span> <span class="n">assets</span><span class="p">.</span><span class="k">open</span><span class="p">(</span><span class="s">&#34;myreactapp/index.html&#34;</span><span class="p">)</span>
                    <span class="n">indexHtml</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div><p>This will execute the react app under assets/myreactapp folder when broswing http://localhost:8080/myreactapp/ in webview.</p>
<p>Now <a href="https://ktor.io/">Ktor</a> server didn&rsquo;t support iOS so you might find some alternatives.</p>
<p>Using WebView can share UI development for both Android and iOS, but you still need develop REST APIs for each platform. It still have some benefits as you can using all native features and get native performance.</p>

    </div>
  </article>

  <article class="ph4-ns pv5-ns">
    
    <h1 class="f2 fw1 avenir blog-heading">Care for Detail</h1>
    
    <time class="f6 db gray avenir">2020-09-07</time>
    <div class="f6 black-70 avenir lh-copy">
      <p>I used a lot of Python for development, it&rsquo;s very convenient but also easily to make mistakes if you&rsquo;re careless.
One of the mistakes is abuse of list. In Python, list is an array like container. When you try to find a value in a list, the time complexity is O(n) but if do that in a set or a dict, the time complexity is O(1) and it&rsquo;s faster. It&rsquo;s better to use set or dict to storing unique key values rather than list.</p>
<p>There is antoher list called deque in Python, it&rsquo;s a linked list like container. The advantage using deque is adding item in first or end is faster than that in list. Consider following problem:
Giving a number N, build a string that contains 1 to N, but if a number is mutiple of 5 swap the two before it. For instance, N = 13, return &ldquo;12435679810111213&rdquo;.</p>
<p>We could do like this in Python:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">build_string</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">s</span>
</code></pre></div><p>It should work but using + operator to build string is very slow and get O(n^2) time complexity. Let&rsquo;s try using list</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">build_string</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</code></pre></div><p>It&rsquo;s still get O(n^2) since insert requires O(n), let&rsquo;s try to use deque:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="k">def</span> <span class="nf">build_string</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">s</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">s</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</code></pre></div><p>Now it get O(n) and run fast!</p>

    </div>
  </article>

  <article class="ph4-ns pv5-ns">
    
    <h1 class="f2 fw1 avenir blog-heading">Querying in Prometheus</h1>
    
    <time class="f6 db gray avenir">2020-06-02</time>
    <div class="f6 black-70 avenir lh-copy">
      <p>By using <a href="https://prometheus.io/">prometheus</a>, server monitoring becomes much easier.
Prometheus cannot provide any server system information, which need to collect from <a href="https://prometheus.io/docs/guides/node-exporter/">node explorer</a> or <a href="https://github.com/google/cadvisor">cadvisor</a>.</p>
<p>So what is promethus for? one of the features is querying by
<a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL</a>, to generate more meaningful information.</p>
<p>For example, if we want to know CPU usage of containers,
we can use:</p>
<pre><code>rate(container_cpu_seconds_total[5m]) * 100
</code></pre><p>container_cpu_seconds_total is how many seconds of CPU used in a container, rate is a function to take average value in range, 5m means 5 minutes and * 100 to convert to percentage.</p>
<p>If we get two servers with same configaration and we want to see the avarage CPU usages, it can be querying by:</p>
<pre><code>(sum by (name) (rate(container_cpu_seconds_total[5m]) * 100))
/(count by (name) (container_cpu_seconds_total))
</code></pre><p>using sum by name to get the values group by name, and count by name to get the count of containers, then the result is average of two servers CPU usage.</p>

    </div>
  </article>

  <article class="ph4-ns pv5-ns">
    
    <h1 class="f2 fw1 avenir blog-heading">Simple Ways to Split Large List into Celery</h1>
    
    <time class="f6 db gray avenir">2020-05-24</time>
    <div class="f6 black-70 avenir lh-copy">
      <p>When getting a large list of records from database it causes
that task running very slow in <a href="https://docs.celeryproject.org/">Celery</a>. Celery is a task worker
that usually to handle time consume job in daemon.</p>
<p>Let say we get 2000+ records in a database table posts, a simple way
to split that just limit the records from the query</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># using django ORM syntax, get 100 records each time</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[:</span><span class="mi">100</span><span class="p">]</span>
<span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
   <span class="n">handle_post</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</code></pre></div><p>Even more we can randomly get from first or end</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># to get the records from first or end, not just stacked on first</span>
<span class="n">sort</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">else</span> <span class="s1">&#39;-id&#39;</span>

<span class="c1"># using django ORM syntax, get 100 records each time</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">sort</span><span class="p">)[:</span><span class="mi">100</span><span class="p">]</span>
<span class="c1"># ...</span>
</code></pre></div><p>It would make task loading more balance.</p>

    </div>
  </article>

  <article class="ph4-ns pv5-ns">
    
    <h1 class="f2 fw1 avenir blog-heading">1/2 = 1 - 1 &#43; 1 - 1 &#43; 1 ...</h1>
    
    <time class="f6 db gray avenir">2020-05-21</time>
    <div class="f6 black-70 avenir lh-copy">
      <p>There is a mathematics question:
$$1 - 1 + 1 - 1 + 1 &hellip;$$ for infinitely
you might know the answer is 1/2 by a simple proof:
$$\text{Let}\ S = 1 - 1 + 1 - 1 &hellip;$$
$$S = 1 - (1 - 1 + 1 - 1 &hellip;)$$
$$S = 1 - S$$
$$S = \frac 1 2$$</p>
<p>The result seems quite not make sense since when you calculate that step by step,
it always return 0 or 1.
So how is it possible? let&rsquo;s try to reverse the answers:
$$\frac 1 2 = (1-\frac 1 2) = (1 - (1 - \frac 1 2)) = (1 - (1 - (1 - \frac 1 2))) = (1 - (1 - (1 - (1 - &hellip;)))) = 1 - 1 + 1 - 1 &hellip;$$</p>
<p>It does make sense, but why we cannot calculate 1 - 1 + 1 - 1 &hellip; directly?
It&rsquo;s because it was calculated step by step and will never be infinite!</p>
<p>I also write a simple script of it
<a href="https://stackblitz.com/edit/half-infinty">https://stackblitz.com/edit/half-infinty</a></p>

    </div>
  </article>

  <article class="ph4-ns pv5-ns">
    
    <h1 class="f2 fw1 avenir blog-heading">Build Autocomplete With Angular Material</h1>
    
    <time class="f6 db gray avenir">2020-03-07</time>
    <div class="f6 black-70 avenir lh-copy">
      <p><a href="https://material.angular.io/">Angular Material</a> provides rich UI controls, such as Autocomplete, is very a general UI control for finding a value from a long dataset. In this article we explore how to build an Autocomplete control connected with HTTP service, here is a <a href="https://stackblitz.com/edit/http-autocomplete">complete example</a>.</p>
<p>Install Angular Materail is very easy, just follow the <a href="https://material.angular.io/guide/getting-started">Getting started</a> from the guides.
After the installation import the autocomplete control in app module</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span><span class="nx">MatAutocompleteModule</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/autocomplete&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">MatInputModule</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/input&#39;</span><span class="p">;</span>

<span class="kd">@NgModule</span><span class="p">({</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">MatAutocompleteModule</span><span class="p">,</span>
    <span class="nx">MatInputModule</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">})</span>
</code></pre></div><p>You can check the import statement from <a href="https://material.angular.io/components/autocomplete/api">API reference</a>, <code>MatInputModule</code> is also requried for this example</p>
<p>To display <code>Autocomplete</code>, add the HTML code</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
           <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Pick one&#34;</span>
           <span class="na">matInput</span>
           <span class="err">[</span><span class="na">formControl</span><span class="err">]=&#34;</span><span class="na">myControl</span><span class="err">&#34;</span>
           <span class="err">[</span><span class="na">matAutocomplete</span><span class="err">]=&#34;</span><span class="na">auto</span><span class="err">&#34;</span>
    <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">mat-autocomplete</span> <span class="err">#</span><span class="na">auto</span><span class="o">=</span><span class="s">&#34;matAutocomplete&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">mat-option</span> <span class="err">*</span><span class="na">ngFor</span><span class="o">=</span><span class="s">&#34;let option of filteredOptions | async&#34;</span> <span class="err">[</span><span class="na">value</span><span class="err">]=&#34;</span><span class="na">option</span><span class="err">.</span><span class="na">id</span><span class="err">&#34;</span><span class="p">&gt;</span>
        {{option.name}}
      <span class="p">&lt;/</span><span class="nt">mat-option</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">mat-autocomplete</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div><p>The input text is binding <code>myControl</code> and mat-option is listing <code>filteredOptions</code> which defined in the Compenent</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;my-app&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./app.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;./app.component.css&#39;</span> <span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppComponent</span>  <span class="p">{</span>
  <span class="nx">myControl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="nx">filteredOptions</span>: <span class="kt">Observable</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>It didn&rsquo;t get any action yet, let&rsquo;s make it listing options when input changes</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="nx">ngOnInit() {</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">filteredOptions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">myControl</span><span class="p">.</span><span class="nx">valueChanges</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">startWith</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="nx">switchMap</span><span class="p">(</span><span class="nx">lookupVal</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">lookUp</span><span class="p">(</span><span class="nx">lookupVal</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="nx">lookUp</span><span class="p">(</span><span class="nx">lookupVal</span><span class="p">)</span><span class="o">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">listUrl</span> <span class="o">=</span> <span class="s1">&#39;api/heroes&#39;</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">findUrl</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">listUrl</span><span class="si">}</span><span class="sb">?name=</span><span class="si">${</span><span class="nx">lookupVal</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

  <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">listUrl</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">lookupVal</span><span class="p">)</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">findUrl</span><span class="p">;</span>

  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>the url &lsquo;api/heroes&rsquo; is getting data from a simple http service <a href="https://github.com/angular/in-memory-web-api">in memory web api</a> provides simple CRUD operations. So what happened from above code? Actually it&rsquo;s using <a href="https://rxjs.dev">RxJS</a> library to handle interaction between the form control and filtered options. <code>RxJS</code> is very powerful to handle async data. In above example, <code>valueChanges</code> is returning what you typed in the input text, the <code>pipe</code> method is modifying your inputted text to <code>lookUp</code> method return values, which means when you typed it will make a http call and return the results to Autocomplete options.</p>
<p>Other parts of the code are about the issues such as display correct value in input text,
handle tab key/focus out events. It done in hacky ways, it&rsquo;d better to extend the class to create a custom control.</p>

    </div>
  </article>

</section>


<div class="scrollbar-container">
  <div class="scrollbar">
    <div class="scrollarea">
      <div class="padding"></div>
      <div class="scroller">
        <div class="handle"></div>
      </div>
      <div class="padding"></div>
    </div>
  </div>
</div>

        </div>
        <div id="footer"><div class="mw7 center pa2 footer-wrap">
  <div class="flex items-center justify-between">
    <div class="db"></div>
    <div class="db footer-last">

      <div class="flex items-center justify-end">
      <small class="ph2-ns">Power by <a href="https://gohugo.io/" class="link underline gray hover-blue">Hugo</a></small>

      </div>
    </div>
  </div>
</div>
</div>
    </body>
</html>
